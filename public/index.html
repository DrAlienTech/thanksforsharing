<html>
  <head>
    <title>Thx 4 Sharing</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase.js"></script>

    <!--Email Login -->
    <script>
      firebase.initializeApp({
        apiKey: "AIzaSyBVT22t-x2H76119AHG8SgPU0_A0U-N1uA",
        authDomain: "my-scrap-project.firebaseapp.com",
        databaseURL: "https://my-scrap-project.firebaseio.com",
        projectId: "my-scrap-project",
        storageBucket: "my-scrap-project.appspot.com",
        messagingSenderId: "334998588870",
        appId: "1:334998588870:web:6b218e9655ade3a6c536c7",
        measurementId: "G-66W8QQ9W35"
      });

      var user = auth().currentUser;
      var db = firestore();
      db.enablePersistence();

      function redirect(pagePath) {
        if (pagePath === "signout") {
          firebase.auth().signOut();
          window.location.replace("https://www.thx4sharing.web.app");
        } else {
          //var urlParams = new URLSearchParams(window.location.search);
          //var mode = urlParams.get('mode').toString();
          window.location = pagePath;
        };
        open();
      };

      window.onload = function () {
        //var urlParams = new URLSearchParams(window.location.search);
        //var mode = urlParams.get("darkmode");
        //if (mode == "dark") {
        //  document.getElementByTagName("html").id = "dark";
        //}
      };

      function toggleSignIn() {
        if (!auth().currentUser) {
          var provider = new auth.GoogleAuthProvider();

          auth().signInWithPopup(provider).then(function (result) {
            var token = result.credential.accessToken;
            var user = result.user;
            var uid = user.uid.toString();
            var db = firestore();
            var emails = db.collection("emails");
            var users = db.collection("users");

            auth().onAuthStateChanged(function (user) {
              if (user != null) {
                var user = auth().currentUser;

                user.providerData.forEach(function (profile) {
                  var username = profile.displayName.toString();
                  var email = profile.email.toString();
                  var userDataEmails = emails.doc(username);
                  var userDataUsers = users.doc(uid);

                  userDataEmails.get().then(function (doc) {
                    if (!doc.exists) {
                      userDataEmails.set({
                        email: email,
                        uid: uid,
                      }).then(function () {
                        console.log("Document successfully written!");
                      }).catch(function (error) {
                        console.error("Error writing document: ", error);
                      });
                    } else {
                      console.log("Emails doc already exists, skipped writing.");
                    }
                  });

                  userDataUsers.get().then(function (doc) {
                    if (!doc.exists) {
                      userDataUsers.set({
                        displayName: username,
                        email: email,
                      }).then(function () {
                        console.log("Document successfully written!");
                      }).catch(function (error) {
                        console.error("Error writing document: ", error);
                      });
                    } else {
                      console.log("Users doc already exists, skipped writing.");
                    }
                  });
                  window.location = "index.html?mode=light";
                });
              }
            })
          }).catch(function (error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            var email = error.email;
            var credential = error.credential;
            if (errorCode === 'auth/account-exists-with-different-credential') {
              alert('You have already signed up with a different method for that email. If you want to merge your Google account with an Email/Password account, go to the Account page.');
            } else {
              console.error(error);
            }
          });
        } else {
          auth().signOut();

          var provider = new auth.GoogleAuthProvider();
          auth().signInWithPopup(provider).then(function (result) {
            var token = result.credential.accessToken;
            var user = result.user;
            var uid = user.uid.toString();
            var db = firestore();
            var emails = db.collection("emails");
            var users = db.collection("users");

            auth().onAuthStateChanged(function (user) {
              if (user != null) {
                var user = auth().currentUser;

                user.providerData.forEach(function (profile) {
                  var username = profile.displayName.toString();
                  var email = profile.email.toString();
                  var userDataEmails = emails.doc(username);
                  var userDataUsers = users.doc(uid);

                  userDataEmails.get().then(function (doc) {
                    if (!doc.exists) {
                      userDataEmails.set({
                        email: email,
                        uid: uid,
                      }).then(function () {
                        console.log("Document successfully written!");
                      }).catch(function (error) {
                        console.error("Error writing document: ", error);
                      });
                    } else {
                      console.log("Emails doc already exists, skipped writing.");
                    }
                  });

                  userDataUsers.get().then(function (doc) {
                    if (!doc.exists) {
                      userDataUsers.set({
                        displayName: username,
                        email: email,
                      }).then(function () {
                        console.log("Document successfully written!");
                      }).catch(function (error) {
                        console.error("Error writing document: ", error);
                      });
                    } else {
                      console.log("Users doc already exists, skipped writing.");
                    }
                  });
                  window.location = "home.html?mode=light";
                });
              }
            })
          }).catch(function (error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            var email = error.email;
            var credential = error.credential;
            if (errorCode === 'auth/account-exists-with-different-credential') {
              alert('You have already signed up with a different method for that email. If you want to merge your Google account with an Email/Password account, go to the Account page.');
            } else {
              console.error(error);
            }
          });
        }
      
      <!--Email -->};
    </script>

    <style>
      ::-webkit-scrollbar {
        width: 14px;
      }

      ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 5px grey;
        border-radius: 8px;
      }

      ::-webkit-scrollbar-thumb {
        background: #31a4e1ff;
        border-radius: 8px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #1080bcff;
      }
    </style>
  </head>
  <body>

    <header>
    
      <!--nav begin-->
      <nav>
        <!--Beginning of Logo-->
          <a onclick="redirect('index.html')">Logo Here</a>
        <!--End of Logo-->&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    
        <!--Beginning of Dropdown-->
          <a id="home" class="navelement dropbtn" onclick="redirect('index.html')">Home</a>
        <!--End of Dropdown-->&nbsp;&nbsp;&nbsp;

         <!--Beginning of Dropdown-->
         <a id="home" class="navelement dropbtn" onclick="redirect('index.html')">Products</a>
         <!--End of Dropdown-->&nbsp;&nbsp;&nbsp;

         <!--Beginning of Dropdown-->
         <a id="home" class="navelement dropbtn" onclick="redirect('index.html')">Shopping Cart</a>
         <!--End of Dropdown-->&nbsp;&nbsp;&nbsp;
         
          <!--Beginning of Dropdown-->
          <a id="home" class="navelement dropbtn" onclick="redirect('index.html')">Ch</a>
        <!--End of Dropdown-->&nbsp;&nbsp;&nbsp;

        <!--Beginning of Sign in button-->
          <a id="singin" class="navelement" onclick="signIn()">Sign In</a>
        <!--End of Sign in button-->

        <!--Start of script-->
        <script type="text/javascript">
          function signIn() {
            document.getElementById('popupsignin').style.display = "block";
          };
        </script>
        <!--End of script-->
      </nav>
      <!--nav end-->
    
    </header>
    
    <!--Popup-->
    <div id="popupsignin"class="signin demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <main class="mdl-layout__content mdl-color--grey-100">
        <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
          <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
            <div class="mdl-card__title mdl-color--light-blue-600 mdl-color-text--white">
              <h2 class="mdl-card__title-text">Sign In or Sign Up</h2>
            </div>
            <div class="mdl-card__supporting-text mdl-color-text--grey-600">
  
              <button class="signinoptions" onclick="email()">Email</button>
              <br><br>
              <button class="signinoptions" onclick="google()">Google</button>
              <br><br>
              <button class="signinoptions" onclick="close()">Close</button>
  
            </div>
          </div>
        </div>
      </main>
    </div>
    <!--Popup-->

  </body>
</html>
